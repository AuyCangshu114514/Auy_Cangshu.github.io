<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.css" rel="stylesheet" />
		<style>
			.help{
				
				margin-left: 5%;
				margin-top: 2%;
				
			}
			.help_img{
				width: 7vw;
				/* left: 5%; */
				
			}
			.tip{
				text-align: center;
				width: 71vw;
				background-color: aqua;
				height: 50vw;
				position: fixed;
				left: 50%;
				top: 50%;
				transform: translate(-50%,-50%);
				display: none;
				z-index: 1;
				
			}
			.game_main{
				position: fixed;
				text-align: center;
				top:50vh;
				left:50vw;
				transform: translate(-50%,-50%);
				width: 100vw;
				display: none;
			}
			
			/* game UI */
			.begin{
				text-align: center;
				display: none;
			}
			.combo{
				text-align: center;
				display: none;
				
			}
			.jiesuan{
				width: 100vw;
				height: 100vh;
				background-color: bisque;
				position: fixed;
				z-index: 5;
				display: none;
				left: 50%;
				top: 50%;
				transform: translate(-50%,-50%);
				text-align: center;
			}
			.choose_music{
				display: none;
				position: fixed;
				top: 50%;
				left: 50%;
				transform: translate(-50%,-50%);
				width: 70vw;
				height: 60vh;
				background-color: aquamarine;
				text-align: center;
			}
			
			/* 暂停控件 */
			.puase{
				position: fixed; 
				right: 0%;
				top: 7vh;
				margin-right: 5px;
			}
			.puase_ui{
				position: fixed;
				text-align: center;
				background-color: coral;
				left: 50%;
				top: 50%;
				transform: translate(-50%,-50%);
			
				display: none;
			}
			/* 复制到此处 */
			
			#btn1{
				width: 20vw;
				height: 20vh;
				margin-top: 20px;
			}
			#btn2{
				width: 20vw;
				height: 20vh;
				margin-top: 20px;
			}
			#btn3{
				width: 20vw;
				height: 20vh;
				margin-top: 20px;
			}
			#btn4{
				width: 20vw;
				height: 20vh;
				margin-top: 20px;
			}
		</style>
	</head>

	<body>
		<div class="message" style="position: fixed;right:0%;bottom: 0%;transform: translate(-100% -100%);text-align: right;margin: 0 5px 5px 0;">
			<p>Provide by Auy_Cangshu</p>
			<p>XIANG SHI</p>
		</div>
		<script src="../js/mui.js"></script>
		
		
		<header class="mui-bar mui-bar-nav">
			<a class=" mui-icon mui-icon-left-nav mui-pull-left" id = 'back_to_main'></a>
			<h1 class="mui-title">按钮击打</h1>
		</header>
		<!-- 音频文件 -->
		<audio src="../vid/Kankitsu - Chronomia.mp3" id = 'music01' class = 'music'>
			
		</audio>
		<div class="mui-content">
			
			<div class='help'>
				<img class='help_img' src='../img/help.png'>
				<p>help</p>
			</div>
			<button type="button" id="begin_choose">选择曲目</button>
			<div class='tip'>
				<h1 align='left'>Tip!</h1>
				<br>
				<span>在按钮变色的时候点击它！</span>
				<br>
				<span>祝你好运!</span>
				<br>
				<br>
				<p>点击任意区域关闭</p>
			</div>
			
			<!-- game -->
			<div class='game_main'>
				<button id = 'btn1'class ='btn1' type="button" class="mui-btn mui-btn-blue mui-btn-outlined">按钮1</button>
				<button id = 'btn2'class ='btn2'type="button" class="mui-btn mui-btn-blue mui-btn-outlined">按钮2</button>
				<button id = 'btn3'class ='btn3'type="button" class="mui-btn mui-btn-blue mui-btn-outlined">按钮3</button>
				<button id = 'btn4'class ='btn4'type="button" class="mui-btn mui-btn-blue mui-btn-outlined">按钮4</button>
			</div>
			<!-- 开始按钮 -->
			<div class="begin">
				<button id ='begin'>Start</button>
				<p class='music_message'>Chronomia</p>
			</div>
			
			
			
			<!-- 选择曲目 模块 -->
			<!-- <div class='choose_music'>
				<img src="../img/close.png" class='close_choose'>
				<h1>曲目选择</h1>
				<button id = 'wet_hand'>wet hand</button>
				<button id = 'sakura'>樱树街道</button>
				<button id = 'el'>El último baile</button>
			</div> -->
			
			
			
			
			<div class='combo'>
				<h1 class='combo_num'>0</h1>
				<p class='combo_text'>COMBO</p>
			</div>
		</div>
		<div class='jiesuan'>
			<br>
			<br>
			<br>
			<h1 class='ninwanchengle'>您完成了!</h1>
			<br>
			<h4 align = 'right' class = 'score_100w'>score</h4>
			<h2 class="combo_text_over">num</h2>
			<p>COMBO</p>
			<h1 class="fen">score</h1>
			<br>
			<img src="../img/close.png" class = 'again'>
			<p>再来一次！</p>
		</div>
		
		<!-- 暂停 -->
		
		<div class='puase'>
			<img src='../img/fb_live_look.png' class='puase_btn'>
		</div>
		<div class='puase_ui'>
			<h1>您已暂停！</h1>
			
			
			<img src='../img/gsc_web_container_view_refresh.png' style="width: 10vw;" class = 're_again'>
		</div>
		<!-- 复制到此处 -->
		
		
		
		
		
		
		<!-- JS -->
		<script type="text/javascript">
			mui.init()
			var help = true
			var combo = 0
			var score = 0
			var a = 0
			var music_01 = document.getElementById('music01')
			
			var back_to_main = document.getElementById('back_to_main')
			back_to_main.onclick = function(){
				mui.openWindow('../main.html')
			}
			
			// 选择曲目---start
			game_ui_block()
			var begin_choose = document.getElementById('begin_choose')
			begin_choose.onclick = function(){
				// mui('.choose_music')[0].style='display:block;'
				mui.openWindow('hit_btn_main.html')
			}
			// 选择 wet hand
			// var wet_hand_c = document.getElementById('wet_hand')
			// wet_hand_c.onclick = function(){
			// 	a = 0
			// }
			// var sakura_c = document.getElementById('sakura')
			// sakura_c.onclick = function(){
			// 	mui.openWindow('sakura.html')
			// }
			
			// mui('.close_choose')[0].addEventListener('tap',function(){
			// 	mui('.choose_music')[0].style='display:none;'
			// })
			// 选择曲目---end
			
			// 暂停
			
			// 暂停控件（
			mui('.puase_btn')[0].addEventListener('tap',function(){
				mui('.puase_ui')[0].style = 'display:block;'
				music_01.pause()
			})
			
			mui('.re_again')[0].addEventListener('tap',function(){
				mui('.puase_ui')[0].style = 'display:none;'
				music_01.load()
				location.reload()
			})
			// 复制到此处（
			
			
			mui('.again')[0].addEventListener('tap',function(){
				location.reload()
			})
			mui('.tip')[0].addEventListener('tap',function(){
				mui('.tip')[0].style = 'display:none;'
				game_ui_block()
				help = false
			})
			mui('.help')[0].addEventListener('tap',function(){
				mui('.tip')[0].style= 'display:block'
				game_ui_none()
				help = true
			})
			function game_ui_block(){
				mui('.begin')[0].style='display:block'
				mui('.combo')[0].style='display:block'
				mui('.game_main')[0].style='display:block'
			}
			function game_ui_none(){
				mui('.begin')[0].style= 'display:none'
				mui('.combo')[0].style= 'display:none'
				mui('.game_main')[0].style= 'display:none'
			}
			// 开始按钮
			var bg_btn = document.getElementById('begin')
			
			bg_btn.onclick = function(){
				bg_btn.style = 'display:none;'
				var lose_time
				mui('.combo_num')[0].innerHTML = '3'
				mui('.combo_text')[0].innerHTML = 'READY'
				lose_time = setTimeout(function(){
					mui('.combo_num')[0].innerHTML = '2'
				},1000)
				lose_time =setTimeout(function(){
					mui('.combo_num')[0].innerHTML = '1'
				},2000)
				lose_time =setTimeout(function(){
					mui('.combo_num')[0].innerHTML = '0'
					mui('.combo_text')[0].innerHTML = 'COMBO'
				},3000)
				setTimeout(function(){
					clearTimeout(lose_time)
				},3010)
				setTimeout(function(){
					game_main()
					// 加载歌曲
					
					music_01.play()
				},4000)
				
				
				
				
			} 
			var up_btn
			// 所有谱面文件
			var all_pumian = [
				{pumian_unload:[2985,4288,4639,5023,5310,5457,5611,6272,6600,6846,
				7143,7448,8424,8816,9166,9346,9519,10520,10831,11113,11393,11688,
				12711,13112,13472,13767,14349,14590,15773,15851,16109,16319,16665,
				16972,17343,17712,18001,18919,20096,20514,20855,21315,22171,23788,
				24321,24744,25160,25883,26009,26387,26511,26919,27223,28213,28231,
				28485,28608,28982,29339,30639,32417,32735,33319,33590,34240,34390,
				34781,34910,35417,35670,36596,36630,36910,37039,37423,37768,39202,
				39488,39738,39991,40262,40520,40783,41031,41310,41575,41890,42177,
				42472,42730,43014,43295,43566,43830,44095,44392,44695,44928,45176,
				45453,45846,46395,46921,47506,47904,48332,48664,49544,49838,50143,
				50438,50752,51048,51320,51575,51863,52368,52639,52911,53400,53657,
				53920,54174,54315,58251,58802,59175,59607,60595,61078,61287,61870,
				62488,70834,71879,72231,72616,72894,73063,73216,73333,73971,74413,
				74561,74969,75118,76119,76594,76846,77107,78248,78535,78791,79047,
				79461,80360,80888,81128,81614,81880,82364,83303,83536,83590,83951,
				84286,84569,84894,85295,85607,86519,86694,87786,88136,88457,88727,
				89088,89457,89791,90062,90551,90889,91295,91751,92008,92448,93007,
				93480,94073,94615,95131,95679,96199,98193,98239,98522,99293,99337,
				99627,100150,100373,100421,100691,102345,102406,102699,103280,103507,
				103552,103779,104111,104851,105079,105573,106855,107332,107847,108371
				,108888,109401,109944,110479,111040,111530,112031,112512,113064,113601,
				114136,114647,115186,115239,115473,116221,116286,116507,117291,117318,
				117561,119407,119446,119700,120279,120468,120495,120725,121024,121724,
				121959,122473,123629,123931,124560,124769,124842,125511,125758,125814,
				127776,128007,128038,128655,128860,128903,129131,129463,130171,130423,
				131016,132034,132283,132793,133132,133459,133732,133953,134175,134359,
				134622,134767,134984,135375,135543,135784,135943,136185,136326,136495,
				136751,136922,137159,137340,137559,137775,137953,138191,138352,138591,
				138775,139040,139215,139417,139767,139935,140183,140351,140560,140731,
				141906]
				,name:"Chronomia",url:"../vid/Kankitsu - Chronomia.mp3"},
				
			
				
			]
			var pumian
			var color =['red','yellow','green','blue']
			var up_color
			// 加载谱面
			
			function loading_pumian(a){
				// console.log(all_pumian[a].name)
				// console.log(all_pumian[a].pumian_unload)
				// console.log(all_pumian[a].url)
				mui('.music_message')[a].innerHTML = all_pumian[a].name
				pumian = all_pumian[a].pumian_unload
				mui('.music')[a].src = all_pumian[a].url
				
			}
			
			
			
			function over(score,combo){
				mui('.jiesuan')[0].style = 'display: block;'
				mui('.combo_text_over')[0].innerHTML = combo
				var fen = score / pumian.length 
				// console.log(fen)
				
				if (fen >= 0.96 && fen < 1){
					mui('.fen')[0].style = 'color:white;'
					mui('.fen')[0].innerHTML = 'V'
				}
				if(fen >= 0.88 && fen < 0.92){
					mui('.fen')[0].style = 'color:white;'
					mui('.fen')[0].innerHTML = 'A'
				}
				if(fen >= 0.92 && fen < 0.96){
					mui('.fen')[0].style = 'color:white;'
					mui('.fen')[0].innerHTML = 'S'
				}
				if(fen >= 0.82 && fen < 0.88){
					mui('.fen')[0].style = 'color:white;'
					mui('.fen')[0].innerHTML = 'B'
				}
				if(fen >= 0.65 && fen < 0.82){
					mui('.fen')[0].style = 'color:white;'
					mui('.fen')[0].innerHTML = 'C'
				}
				if(fen <= 0.65){
					mui('.fen')[0].style = 'color:white;'
					mui('.fen')[0].innerHTML = 'F'
				}
				if( fen == 1 && combo == pumian.length){
					mui('.fen')[0].style = 'color:yellow;'
					mui('.fen')[0].innerHTML = 'AP'
				}
				if(fen == 1 && combo != pumian.length){
					mui('.fen')[0].style = 'color:blue;'
					mui('.fen')[0].innerHTML = 'V'
				}
				if(fen > 1){
					mui('.fen')[0].style = 'color:red;'
					mui('.fen')[0].innerHTML = 'φ'
					mui('.ninwanchengle')[0].innerHTML = '您作弊了！'
				}
				fen = fen * 1000000
				fen = parseInt(fen)
				if (fen < 1000000){
					fen = '0' + fen
				}
				mui('.score_100w')[0].innerHTML = fen
			}
			
			
			function btn_color(){
				
				// 选择颜色
				up_color = Math.random()*3
				up_color = color[parseInt(up_color)]
				return up_color
				// alert(up_btn+up_color) 
				// [num+color]			
			}
			function btn_num(){
				// 选择按钮
				up_btn = Math.random()*4 + 1
				up_btn = parseInt(up_btn)
				up_btn = '.btn'+up_btn
				return up_btn
			}
			var color_time
			function game_main(){
				
				
				//解析谱面
				loading_pumian(a)//调用加载谱面函数
				var puzi
				var len = pumian.length
				
				
				
				for(var i = 0; i < len;i++){
					// alert(i)
					color_time = pumian[i]
					up_color = btn_color()//调用选择按钮颜色
					up_btn = btn_num()//调用选择按钮几
						// 应用谱面
					puzi = setTimeout(function(){
					mui(btn_num())[0].style = 'background-color: ' + up_color + ';'
					},color_time-200)
					
					
					on_click(up_btn)//判定点击
					
						
				}	
				// 游戏分数
				setTimeout(function(){
					// console.log('over')
					over(score,combo)
				},pumian[pumian.length - 1] + 3000)
			}
			var onclick_btn
			// 点击后颜色消失
			function on_click(up_btn){
				// btn1
				var btn1_hit = document.getElementById('btn1')
				
				onclick_btn = '.btn1'
				btn1_hit.onclick = function(){
					click_if(btn1_hit)
					mui('.btn1')[0].style = 'background-color: white;'
					
				}
				// btn2
				var btn2_hit = document.getElementById('btn2')
				onclick_btn = '.btn2'
				
				btn2_hit.onclick = function(){
					click_if(btn2_hit)
					mui('.btn2')[0].style = 'background-color: white;'
					
				}
				// btn3
				var btn3_hit = document.getElementById('btn3')
				onclick_btn = '.btn3'
				
				btn3_hit.onclick = function(){
					click_if(btn3_hit)
					mui('.btn3')[0].style = 'background-color: white;'
					
				}
				// btn4
				var btn4_hit = document.getElementById('btn4')
				onclick_btn = '.btn4'
				
				btn4_hit.onclick = function(){
					click_if(btn4_hit)
					mui('.btn4')[0].style = 'background-color: white;'
					
				}
			}
			// 判定点击
			function click_if(btn_name){
				var click_btn = getComputedStyle(btn_name)['background-color']
				// console.log(click_btn)
				if(click_btn != 'rgb(255, 255, 255)'){
					combo = combo + 1
					score = score + 1
					mui('.combo_num')[0].innerHTML = combo
				}
				else{
					combo = 0
					mui('.combo_num')[0].innerHTML = combo
				}
			}
		</script>
	</body>

</html>