<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.css" rel="stylesheet" />
		<style>
			.help{
				
				margin-left: 5%;
				margin-top: 2%;
				
			}
			.help_img{
				width: 7vw;
				/* left: 5%; */
				
			}
			.tip{
				text-align: center;
				width: 71vw;
				background-color: aqua;
				height: 50vw;
				position: fixed;
				left: 50%;
				top: 50%;
				transform: translate(-50%,-50%);
				display: none;
				z-index: 1;
				
			}
			.game_main{
				position: fixed;
				text-align: center;
				top:50vh;
				left:50vw;
				transform: translate(-50%,-50%);
				width: 100vw;
				display: none;
			}
			#btn1{
				width: 20vw;
				height: 20vh;
				margin-top: 20px;
			}
			#btn2{
				width: 20vw;
				height: 20vh;
				margin-top: 20px;
			}
			#btn3{
				width: 20vw;
				height: 20vh;
				margin-top: 20px;
			}
			#btn4{
				width: 20vw;
				height: 20vh;
				margin-top: 20px;
			}
			
			/* game UI */
			.begin{
				text-align: center;
				display: none;
			}
			.combo{
				text-align: center;
				display: none;
				
			}
			.jiesuan{
				width: 100vw;
				height: 100vh;
				background-color: bisque;
				position: fixed;
				z-index: 5;
				display: none;
				left: 50%;
				top: 50%;
				transform: translate(-50%,-50%);
				text-align: center;
			}
			.choose_music{
				display: none;
				position: fixed;
				top: 50%;
				left: 50%;
				transform: translate(-50%,-50%);
				width: 70vw;
				height: 60vh;
				background-color: aquamarine;
				text-align: center;
			}
			
			/* 暂停控件 */
			.puase{
				position: fixed; 
				right: 0%;
				top: 7vh;
				margin-right: 5px;
			}
			.puase_ui{
				position: fixed;
				text-align: center;
				background-color: coral;
				left: 50%;
				top: 50%;
				transform: translate(-50%,-50%);
				display: none;
			}
			/* 复制到此处 */
		</style>
	</head>

	<body>
		<div class="message" style="position: fixed;right:0%;bottom: 0%;transform: translate(-100% -100%);text-align: right;margin: 0 5px 5px 0;">
			<p>Provide by Auy_Cangshu</p>
			<p>XIANG SHI</p>
		</div>
		<script src="../js/mui.js"></script>
		
		
		<header class="mui-bar mui-bar-nav">
			<a class=" mui-icon mui-icon-left-nav mui-pull-left" id = 'back_to_main'></a>
			<h1 class="mui-title">按钮击打</h1>
		</header>
		<!-- 音频文件 -->
		<audio src="../vid/shenhua.mp3" id = 'music01' class = 'music'>
			
		</audio>
		<div class="mui-content">
			
			<div class='help'>
				<img class='help_img' src='../img/help.png'>
				<p>help</p>
			</div>
			<button type="button" id="begin_choose">选择曲目</button>
			<div class='tip'>
				<h1 align='left'>Tip!</h1>
				<br>
				<span>在按钮变色的时候点击它！</span>
				<br>
				<span>祝你好运!</span>
				<br>
				<br>
				<p>点击任意区域关闭</p>
			</div>
			
			<!-- game -->
			<div class='game_main'>
				<button id = 'btn1'class ='btn1' type="button" class="mui-btn mui-btn-blue mui-btn-outlined">按钮1</button>
				<button id = 'btn2'class ='btn2'type="button" class="mui-btn mui-btn-blue mui-btn-outlined">按钮2</button>
				<button id = 'btn3'class ='btn3'type="button" class="mui-btn mui-btn-blue mui-btn-outlined">按钮3</button>
				<button id = 'btn4'class ='btn4'type="button" class="mui-btn mui-btn-blue mui-btn-outlined">按钮4</button>
			</div>
			<!-- 开始按钮 -->
			<div class="begin">
				<button id ='begin'>Start</button>
				<p class='music_message'>神話</p>
			</div>
			
			
			
			<!-- 选择曲目 模块 -->
			<!-- <div class='choose_music'>
				<img src="../img/close.png" class='close_choose'>
				<h1>曲目选择</h1>
				<button id = 'wet_hand'>wet hand</button>
				<button id = 'sakura'>樱树街道</button>
				<button id = 'el'>El último baile</button>
			</div> -->
			
			
			
			
			<div class='combo'>
				<h1 class='combo_num'>0</h1>
				<p class='combo_text'>COMBO</p>
			</div>
		</div>
		<div class='jiesuan'>
			<br>
			<br>
			<br>
			<h1 class='ninwanchengle'>您完成了!</h1>
			<br>
			<h4 align = 'right' class = 'score_100w'>score</h4>
			<h2 class="combo_text_over">num</h2>
			<p>COMBO</p>
			<h1 class="fen">score</h1>
			<br>
			<img src="../img/close.png" class = 'again'>
			<p>再来一次！</p>
		</div>
		
		<!-- 暂停 -->
		
		<div class='puase'>
			<img src='../img/fb_live_look.png' class='puase_btn'>
		</div>
		<div class='puase_ui'>
			<h1>您已暂停！</h1>
			
			
			<img src='../img/gsc_web_container_view_refresh.png' style="width: 10vw;" class = 're_again'>
		</div>
		<!-- 复制到此处 -->
		
		
		
		
		
		
		<!-- JS -->
		<script type="text/javascript">
			mui.init()
			var help = true
			var combo = 0
			var score = 0
			var a = 0
			var music_01 = document.getElementById('music01')
			
			var back_to_main = document.getElementById('back_to_main')
			back_to_main.onclick = function(){
				mui.openWindow('../main.html')
			}
			
			// 选择曲目---start
			game_ui_block()
			var begin_choose = document.getElementById('begin_choose')
			begin_choose.onclick = function(){
				// mui('.choose_music')[0].style='display:block;'
				mui.openWindow('hit_btn_main.html')
			}
			// 选择 wet hand
			// var wet_hand_c = document.getElementById('wet_hand')
			// wet_hand_c.onclick = function(){
			// 	a = 0
			// }
			// var sakura_c = document.getElementById('sakura')
			// sakura_c.onclick = function(){
			// 	mui.openWindow('sakura.html')
			// }
			
			// mui('.close_choose')[0].addEventListener('tap',function(){
			// 	mui('.choose_music')[0].style='display:none;'
			// })
			// 选择曲目---end
			
			// 暂停
			
			// 暂停控件（
			mui('.puase_btn')[0].addEventListener('tap',function(){
				mui('.puase_ui')[0].style = 'display:block;'
				music_01.pause()
			})
			
			mui('.re_again')[0].addEventListener('tap',function(){
				mui('.puase_ui')[0].style = 'display:none;'
				music_01.load()
				location.reload()
			})
			// 复制到此处（
			
			
			mui('.again')[0].addEventListener('tap',function(){
				location.reload()
			})
			mui('.tip')[0].addEventListener('tap',function(){
				mui('.tip')[0].style = 'display:none;'
				game_ui_block()
				help = false
			})
			mui('.help')[0].addEventListener('tap',function(){
				mui('.tip')[0].style= 'display:block'
				game_ui_none()
				help = true
			})
			function game_ui_block(){
				mui('.begin')[0].style='display:block'
				mui('.combo')[0].style='display:block'
				mui('.game_main')[0].style='display:block'
			}
			function game_ui_none(){
				mui('.begin')[0].style= 'display:none'
				mui('.combo')[0].style= 'display:none'
				mui('.game_main')[0].style= 'display:none'
			}
			// 开始按钮
			var bg_btn = document.getElementById('begin')
			
			bg_btn.onclick = function(){
				bg_btn.style = 'display:none;'
				var lose_time
				mui('.combo_num')[0].innerHTML = '3'
				mui('.combo_text')[0].innerHTML = 'READY'
				lose_time = setTimeout(function(){
					mui('.combo_num')[0].innerHTML = '2'
				},1000)
				lose_time =setTimeout(function(){
					mui('.combo_num')[0].innerHTML = '1'
				},2000)
				lose_time =setTimeout(function(){
					mui('.combo_num')[0].innerHTML = '0'
					mui('.combo_text')[0].innerHTML = 'COMBO'
				},3000)
				setTimeout(function(){
					clearTimeout(lose_time)
				},3010)
				setTimeout(function(){
					game_main()
					// 加载歌曲
					
					music_01.play()
				},4000)
				
				
				
				
			} 
			var up_btn
			// 所有谱面文件
			var all_pumian = [
				{pumian_unload:[5065,5257,5498,5974,6196,6427,6898,7082,7354,
				7819,8020,8282,8762,9161,9669,10125,10590,11057,11514,11987,
				12490,12929,13385,13845,14283,14729,15197,15653,16130,16882,
				17106,17797,18153,18250,18641,18752,19105,19484,19630,19666,
				19878,19914,20554,20785,21016,21247,21456,21698,21930,22172,
				22409,22635,23181,23202,23429,23440,23687,24233,24467,25135,
				25370,25593,25824,26082,26318,26830,26857,27079,27113,27371,
				27902,28139,28354,28580,28801,29045,29283,29507,29723,29970,
				30554,30801,30842,31033,31338,31594,31843,32066,32304,32536,
				32795,33129,33460,33690,33932,34179,34401,34628,34969,35284,
				35536,35750,35947,36196,36473,36606,36919,37386,37817,38301,
				38683,38991,39209,39453,39688,39921,40186,40514,40852,41073,
				41313,41546,41807,42050,42388,42698,42906,43129,43338,43577,
				43930,44265,44539,44777,45013,45251,45468,45713,46113,46563,
				46929,46977,47208,47313,47570,47802,48017,48332,48458,48913,
				49153,49386,49811,50027,50281,50602,50794,51018,51243,51466,
				51689,51921,52169,52578,52808,53241,53516,54094,54243,54471,
				54504,54769,54978,55186,55418,55652,55892,56266,56614,56737,
				57201,57548,57674,57997,58034,58285,58386,58625,58849,59081,
				59330,59555,60449,63194,66890,70579,73331,74273,75243,75675,
				76142,76628,77108,77532,77993,78473,78938,79395,79810,80235,
				80724,81198,81658,82140,82618,83026,83507,83979,84463,84678,
				84705,85010,85354,85821,86403,86416,86660,86818,87218,87661,
				88150,88593,89050,89506,89962,90379,90863,91250,91288,91502,
				91625,91874,92114,92353,92572,92825,93377,93481,93836,94141,
				94482,94586,94939,94977,95199,95305,95667,95789,96161,96248,
				96675,96908,97241,97377,97950,98260,98636,98680,98952,99053,
				99281,99511,99721,100036,100169,100735,100864,101226,101506,
				101842,101978,102269,102323,102545,102642,102996,103114,103521,
				103617,104206,104289,104499,104922,105179,105791,105905,106156,
				106187,106525,106608,106868,107085,107411,107553,108122,108209,
				108610,108922,109239,109354,109709,109777,109997,110091,110426,
				110538,110926,111024,111473,111697,112055,112188,112805,112978,
				113350,113402,113641,113728,114051,114169,114433,114818,114944,
				115521,115659,116040,116329,116686,116796,117083,117145,117365,
				117464,117820,117905,118276,118369,118789,119507,120299,120421,
				121265,121374,121723,121853,122258,122354,122859,122883,123076,
				123114,123323,123898,124276,124346,124724,124836,125214,125322,
				125679,125786,126158,126587,126609,126821,126872,127104,127670,
				127898,128581,128906,129008,129359,129481,129849,130261,130280,
				130499,130571,130801,131065,131437,131528,131895,132027,132359,
				132485,132783,132921,133254,133433]
				,name:"神話",url:"../vid/shenhua.mp3"},
				
			
				
			]
			var pumian
			var color =['red','yellow','green','blue']
			var up_color
			// 加载谱面
			
			function loading_pumian(a){
				// console.log(all_pumian[a].name)
				// console.log(all_pumian[a].pumian_unload)
				// console.log(all_pumian[a].url)
				mui('.music_message')[a].innerHTML = all_pumian[a].name
				pumian = all_pumian[a].pumian_unload
				mui('.music')[a].src = all_pumian[a].url
				
			}
			
			
			
			function over(score,combo){
				mui('.jiesuan')[0].style = 'display: block;'
				mui('.combo_text_over')[0].innerHTML = combo
				var fen = score / pumian.length 
				// console.log(fen)
				
				if (fen >= 0.96 && fen < 1){
					mui('.fen')[0].style = 'color:white;'
					mui('.fen')[0].innerHTML = 'V'
				}
				if(fen >= 0.88 && fen < 0.92){
					mui('.fen')[0].style = 'color:white;'
					mui('.fen')[0].innerHTML = 'A'
				}
				if(fen >= 0.92 && fen < 0.96){
					mui('.fen')[0].style = 'color:white;'
					mui('.fen')[0].innerHTML = 'S'
				}
				if(fen >= 0.82 && fen < 0.88){
					mui('.fen')[0].style = 'color:white;'
					mui('.fen')[0].innerHTML = 'B'
				}
				if(fen >= 0.65 && fen < 0.82){
					mui('.fen')[0].style = 'color:white;'
					mui('.fen')[0].innerHTML = 'C'
				}
				if(fen <= 0.65){
					mui('.fen')[0].style = 'color:white;'
					mui('.fen')[0].innerHTML = 'F'
				}
				if( fen == 1 && combo == pumian.length){
					mui('.fen')[0].style = 'color:yellow;'
					mui('.fen')[0].innerHTML = 'AP'
				}
				if(fen == 1 && combo != pumian.length){
					mui('.fen')[0].style = 'color:blue;'
					mui('.fen')[0].innerHTML = 'V'
				}
				if(fen > 1){
					mui('.fen')[0].style = 'color:red;'
					mui('.fen')[0].innerHTML = 'φ'
					mui('.ninwanchengle')[0].innerHTML = '您作弊了！'
				}
				fen = fen * 1000000
				fen = parseInt(fen)
				if (fen < 1000000){
					fen = '0' + fen
				}
				mui('.score_100w')[0].innerHTML = fen
			}
			
			
			function btn_color(){
				
				// 选择颜色
				up_color = Math.random()*3
				up_color = color[parseInt(up_color)]
				return up_color
				// alert(up_btn+up_color) 
				// [num+color]			
			}
			function btn_num(){
				// 选择按钮
				up_btn = Math.random()*4 + 1
				up_btn = parseInt(up_btn)
				up_btn = '.btn'+up_btn
				return up_btn
			}
			var color_time
			function game_main(){
				
				
				//解析谱面
				loading_pumian(a)//调用加载谱面函数
				var puzi
				var len = pumian.length
				
				
				
				for(var i = 0; i < len;i++){
					// alert(i)
					color_time = pumian[i]
					up_color = btn_color()//调用选择按钮颜色
					up_btn = btn_num()//调用选择按钮几
						// 应用谱面
					puzi = setTimeout(function(){
					mui(btn_num())[0].style = 'background-color: ' + up_color + ';'
					},color_time-200)
					
					
					on_click(up_btn)//判定点击
					
						
				}	
				// 游戏分数
				setTimeout(function(){
					// console.log('over')
					over(score,combo)
				},pumian[pumian.length - 1] + 3000)
			}
			var onclick_btn
			// 点击后颜色消失
			function on_click(up_btn){
				// btn1
				var btn1_hit = document.getElementById('btn1')
				
				onclick_btn = '.btn1'
				btn1_hit.onclick = function(){
					click_if(btn1_hit)
					mui('.btn1')[0].style = 'background-color: white;'
					
				}
				// btn2
				var btn2_hit = document.getElementById('btn2')
				onclick_btn = '.btn2'
				
				btn2_hit.onclick = function(){
					click_if(btn2_hit)
					mui('.btn2')[0].style = 'background-color: white;'
					
				}
				// btn3
				var btn3_hit = document.getElementById('btn3')
				onclick_btn = '.btn3'
				
				btn3_hit.onclick = function(){
					click_if(btn3_hit)
					mui('.btn3')[0].style = 'background-color: white;'
					
				}
				// btn4
				var btn4_hit = document.getElementById('btn4')
				onclick_btn = '.btn4'
				
				btn4_hit.onclick = function(){
					click_if(btn4_hit)
					mui('.btn4')[0].style = 'background-color: white;'
					
				}
			}
			// 判定点击
			function click_if(btn_name){
				var click_btn = getComputedStyle(btn_name)['background-color']
				// console.log(click_btn)
				if(click_btn != 'rgb(255, 255, 255)'){
					combo = combo + 1
					score = score + 1
					mui('.combo_num')[0].innerHTML = combo
				}
				else{
					combo = 0
					mui('.combo_num')[0].innerHTML = combo
				}
			}
		</script>
	</body>

</html>