<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.css" rel="stylesheet" />
		<style>
			.help{
				
				margin-left: 5%;
				margin-top: 2%;
				
			}
			.help_img{
				width: 7vw;
				/* left: 5%; */
				
			}
			.tip{
				text-align: center;
				width: 71vw;
				background-color: aqua;
				height: 50vw;
				position: fixed;
				left: 50%;
				top: 50%;
				transform: translate(-50%,-50%);
				display: none;
				z-index: 1;
				
			}
			.game_main{
				position: fixed;
				text-align: center;
				top:50vh;
				left:50vw;
				transform: translate(-50%,-50%);
				width: 100vw;
				display: none;
			}
			
			/* game UI */
			.begin{
				text-align: center;
				display: none;
			}
			.combo{
				text-align: center;
				display: none;
				
			}
			.jiesuan{
				width: 100vw;
				height: 100vh;
				background-color: bisque;
				position: fixed;
				z-index: 5;
				display: none;
				left: 50%;
				top: 50%;
				transform: translate(-50%,-50%);
				text-align: center;
			}
			.choose_music{
				display: none;
				position: fixed;
				top: 50%;
				left: 50%;
				transform: translate(-50%,-50%);
				width: 70vw;
				height: 60vh;
				background-color: aquamarine;
				text-align: center;
			}
			
			/* 暂停控件 */
			.puase{
				position: fixed; 
				right: 0%;
				top: 7vh;
				margin-right: 5px;
			}
			.puase_ui{
				position: fixed;
				text-align: center;
				background-color: coral;
				left: 50%;
				top: 50%;
				transform: translate(-50%,-50%);
			
				display: none;
			}
			/* 复制到此处 */
			
			#btn1{
				width: 20vw;
				height: 20vh;
				margin-top: 20px;
			}
			#btn2{
				width: 20vw;
				height: 20vh;
				margin-top: 20px;
			}
			#btn3{
				width: 20vw;
				height: 20vh;
				margin-top: 20px;
			}
			#btn4{
				width: 20vw;
				height: 20vh;
				margin-top: 20px;
			}
		</style>
	</head>

	<body>
		<div class="message" style="position: fixed;right:0%;bottom: 0%;transform: translate(-100% -100%);text-align: right;margin: 0 5px 5px 0;">
			<p>Provide by Auy_Cangshu</p>
			<p>XIANG SHI</p>
		</div>
		<script src="../js/mui.js"></script>
		
		
		<header class="mui-bar mui-bar-nav">
			<a class=" mui-icon mui-icon-left-nav mui-pull-left" id = 'back_to_main'></a>
			<h1 class="mui-title">按钮击打</h1>
		</header>
		<!-- 音频文件 -->
		<audio src="../vid/Kankitsu - Chronomia.mp3" id = 'music01' class = 'music'>
			
		</audio>
		<div class="mui-content">
			
			<div class='help'>
				<img class='help_img' src='../img/help.png'>
				<p>help</p>
			</div>
			<button type="button" id="begin_choose">选择曲目</button>
			<div class='tip'>
				<h1 align='left'>Tip!</h1>
				<br>
				<span>在按钮变色的时候点击它！</span>
				<br>
				<span>祝你好运!</span>
				<br>
				<br>
				<p>点击任意区域关闭</p>
			</div>
			
			<!-- game -->
			<div class='game_main'>
				<button id = 'btn1'class ='btn1' type="button" class="mui-btn mui-btn-blue mui-btn-outlined">按钮1</button>
				<button id = 'btn2'class ='btn2'type="button" class="mui-btn mui-btn-blue mui-btn-outlined">按钮2</button>
				<button id = 'btn3'class ='btn3'type="button" class="mui-btn mui-btn-blue mui-btn-outlined">按钮3</button>
				<button id = 'btn4'class ='btn4'type="button" class="mui-btn mui-btn-blue mui-btn-outlined">按钮4</button>
			</div>
			<!-- 开始按钮 -->
			<div class="begin">
				<button id ='begin'>Start</button>
				<p class='music_message'>樱树街道</p>
			</div>
			
			
			
			<!-- 选择曲目 模块 -->
			<!-- <div class='choose_music'>
				<img src="../img/close.png" class='close_choose'>
				<h1>曲目选择</h1>
				<button id = 'wet_hand'>wet hand</button>
				<button id = 'sakura'>樱树街道</button>
				<button id = 'el'>El último baile</button>
			</div> -->
			
			
			
			
			<div class='combo'>
				<h1 class='combo_num'>0</h1>
				<p class='combo_text'>COMBO</p>
			</div>
		</div>
		<div class='jiesuan'>
			<br>
			<br>
			<br>
			<h1 class='ninwanchengle'>您完成了!</h1>
			<br>
			<h4 align = 'right' class = 'score_100w'>score</h4>
			<h2 class="combo_text_over">num</h2>
			<p>COMBO</p>
			<h1 class="fen">score</h1>
			<br>
			<img src="../img/close.png" class = 'again'>
			<p>再来一次！</p>
		</div>
		
		<!-- 暂停 -->
		
		<div class='puase'>
			<img src='../img/fb_live_look.png' class='puase_btn'>
		</div>
		<div class='puase_ui'>
			<h1>您已暂停！</h1>
			
			
			<img src='../img/gsc_web_container_view_refresh.png' style="width: 10vw;" class = 're_again'>
		</div>
		<!-- 复制到此处 -->
		
		
		
		
		
		
		<!-- JS -->
		<script type="text/javascript">
			mui.init()
			var help = true
			var combo = 0
			var score = 0
			var a = 0
			var music_01 = document.getElementById('music01')
			
			var back_to_main = document.getElementById('back_to_main')
			back_to_main.onclick = function(){
				mui.openWindow('../main.html')
			}
			
			// 选择曲目---start
			game_ui_block()
			var begin_choose = document.getElementById('begin_choose')
			begin_choose.onclick = function(){
				// mui('.choose_music')[0].style='display:block;'
				mui.openWindow('hit_btn_main.html')
			}
			// 选择 wet hand
			// var wet_hand_c = document.getElementById('wet_hand')
			// wet_hand_c.onclick = function(){
			// 	a = 0
			// }
			// var sakura_c = document.getElementById('sakura')
			// sakura_c.onclick = function(){
			// 	mui.openWindow('sakura.html')
			// }
			
			// mui('.close_choose')[0].addEventListener('tap',function(){
			// 	mui('.choose_music')[0].style='display:none;'
			// })
			// 选择曲目---end
			
			// 暂停
			
			// 暂停控件（
			mui('.puase_btn')[0].addEventListener('tap',function(){
				mui('.puase_ui')[0].style = 'display:block;'
				music_01.pause()
			})
			
			mui('.re_again')[0].addEventListener('tap',function(){
				mui('.puase_ui')[0].style = 'display:none;'
				music_01.load()
				location.reload()
			})
			// 复制到此处（
			
			
			mui('.again')[0].addEventListener('tap',function(){
				location.reload()
			})
			mui('.tip')[0].addEventListener('tap',function(){
				mui('.tip')[0].style = 'display:none;'
				game_ui_block()
				help = false
			})
			mui('.help')[0].addEventListener('tap',function(){
				mui('.tip')[0].style= 'display:block'
				game_ui_none()
				help = true
			})
			function game_ui_block(){
				mui('.begin')[0].style='display:block'
				mui('.combo')[0].style='display:block'
				mui('.game_main')[0].style='display:block'
			}
			function game_ui_none(){
				mui('.begin')[0].style= 'display:none'
				mui('.combo')[0].style= 'display:none'
				mui('.game_main')[0].style= 'display:none'
			}
			// 开始按钮
			var bg_btn = document.getElementById('begin')
			
			bg_btn.onclick = function(){
				bg_btn.style = 'display:none;'
				var lose_time
				mui('.combo_num')[0].innerHTML = '3'
				mui('.combo_text')[0].innerHTML = 'READY'
				lose_time = setTimeout(function(){
					mui('.combo_num')[0].innerHTML = '2'
				},1000)
				lose_time =setTimeout(function(){
					mui('.combo_num')[0].innerHTML = '1'
				},2000)
				lose_time =setTimeout(function(){
					mui('.combo_num')[0].innerHTML = '0'
					mui('.combo_text')[0].innerHTML = 'COMBO'
				},3000)
				setTimeout(function(){
					clearTimeout(lose_time)
				},3010)
				setTimeout(function(){
					game_main()
					// 加载歌曲
					
					music_01.play()
				},4000)
				
				
				
				
			} 
			var up_btn
			// 所有谱面文件
			var all_pumian = [
				{pumian_unload:[2375,2658,2844,3062,3455,3939,
				4363,4610,4827,5043,5276,5700,5977,6420,6638,
				6864,7087,7308,7530,7748,7943,8141,8398,8625,
				8882,9295,9721,9945,10184,10608,11052,11489,
				11692,11928,12149,12413,12825,13087,13508,13760,
				13981,14187,14426,14621,14860,15055,15282,15489,
				15726,15947,16391,16856,17266,17718,18192,18576,
				18824,19034,19272,19509,19660,19811,19964,20104,
				20442,21028,21326,21755,22192,22636,23059,23530,
				23977,24395,24614,24846,25082,25314,25728,25946,
				26156,26353,26632,26807,26873,26983,27070,27225,
				27361,27604,27676,27755,27922,28140,28502,28613,
				28952,29072,29318,29455,29603,29681,29844,30040,
				30302,30479,30692,30837,30978,31210,31357,31428,
				31548,31730,32018,32194,32405,34095,35584,35759,
				35850,35921,36360,36793,37016,37264,38181,38411,
				38650,38852,38958,39044,39265,39330,39603,40031,
				40436,40681,40884,41712,41964,42175,42504,42624,
				42875,43124,43501,43951,44188,44400,45282,45520,
				45741,45968,46219,46418,46683,47059,47293,47522,
				47703,47779,47925,48016,48248,48430,48655,48864,
				49110,49308,49457,49513,49599,49699,49781,49963,
				50013,50206,50650,51080,51276,51518,52396,52638,
				52845,53077,53163,53274,53656,53893,54268,54645,
				54854,55079,55924,56145,56402,56656,56805,56892,
				57134,57352,57754,58178,58415,58662,59483,59726,
				59977,60206,60442,60664,60895,61286,61538,61736,
				61965,62204,62436,62672,62910,63112,63343,63559,
				63788,63984,64197,64441,67947,68398,68604,69094,
				69486,70410,70582,70732,70919,71112,71328,71755,
				71968,72196,72613,73117,73376,73598,73779,74001,
				74404,74550,74645,74721,74843,74913,75025,75282,
				75371,75776,75901,76123,76412,76638,76875,78559,
				79978,80118,80203,80300,80381,80815,81280,81485,
				81747,82650,82878,83119,83325,83524,83780,83981,
				84431,84841,85056,85304,86226,86464,86650,86871,
				86963,87073,87286,87567,87991,88431,88637,88880,
				89772,90000,90225,90453,90624,90872,91117,91564,
				91784,92048,92207,92309,92409,92648,92874,93192,
				93407,93615,93798,93973,94059,94281,94411,94643,
				95064,95515,95729,95960,96873,97161,97328,97539,
				97629,97741,97967,98205,98593,99041,99300,99539,
				100449,100687,100884,101096,101181,101303,102100,
				102327,102690,102871,103094,103981,104214,104430,
				104661,104894,105120,105358,105775,106017,106219,
				106412,106497,106627,106866,107121,107330,107581,
				107753,108030,108208,108453,108530,108636,108715,
				108838,108923,109316,109709,109957,110203,111098,
				111334,111556,111678,111731,111823,111920,112009,
				112166,112247,112454,112881,113281,113512,113763,
				114667,114910,115133,115338,115413,115530,115774,
				116010,116413,116847,117039,117306,118186,118433,
				118629,118867,119088,119326,119568,119915,120184,
				120436,120634,120763,120870,121097,121320,121586,
				121768,122035,122237,122453,122686,122801,122887,
				122978,123063,123524,123947,124167,124401,125323,
				125575,125761,125983,126069,126186,126414,126625,
				127013,127461,127709,127968,128873,129132,129327,
				129653,129777,130020,130215,130636,131083,131276,
				131521,132415,132657,132890,133127,133314,133573,
				133764,134214,134430,134700,134884,135146,135344,
				135591,135798,136070,136226,136498,136694,136916,
				137108,137336],name:"樱树街道",url:"../vid/yinshujiedao.mp3"},
				
			
				
			]
			var pumian
			var color =['red','yellow','green','blue']
			var up_color
			// 加载谱面
			
			function loading_pumian(a){
				// console.log(all_pumian[a].name)
				// console.log(all_pumian[a].pumian_unload)
				// console.log(all_pumian[a].url)
				mui('.music_message')[a].innerHTML = all_pumian[a].name
				pumian = all_pumian[a].pumian_unload
				mui('.music')[a].src = all_pumian[a].url
				
			}
			
			
			
			function over(score,combo){
				mui('.jiesuan')[0].style = 'display: block;'
				mui('.combo_text_over')[0].innerHTML = combo
				var fen = score / pumian.length 
				// console.log(fen)
				
				if (fen >= 0.96 && fen < 1){
					mui('.fen')[0].style = 'color:white;'
					mui('.fen')[0].innerHTML = 'V'
				}
				if(fen >= 0.88 && fen < 0.92){
					mui('.fen')[0].style = 'color:white;'
					mui('.fen')[0].innerHTML = 'A'
				}
				if(fen >= 0.92 && fen < 0.96){
					mui('.fen')[0].style = 'color:white;'
					mui('.fen')[0].innerHTML = 'S'
				}
				if(fen >= 0.82 && fen < 0.88){
					mui('.fen')[0].style = 'color:white;'
					mui('.fen')[0].innerHTML = 'B'
				}
				if(fen >= 0.65 && fen < 0.82){
					mui('.fen')[0].style = 'color:white;'
					mui('.fen')[0].innerHTML = 'C'
				}
				if(fen <= 0.65){
					mui('.fen')[0].style = 'color:white;'
					mui('.fen')[0].innerHTML = 'F'
				}
				if( fen == 1 && combo == pumian.length){
					mui('.fen')[0].style = 'color:yellow;'
					mui('.fen')[0].innerHTML = 'AP'
				}
				if(fen == 1 && combo != pumian.length){
					mui('.fen')[0].style = 'color:blue;'
					mui('.fen')[0].innerHTML = 'V'
				}
				if(fen > 1){
					mui('.fen')[0].style = 'color:red;'
					mui('.fen')[0].innerHTML = 'φ'
					mui('.ninwanchengle')[0].innerHTML = '您作弊了！'
				}
				fen = fen * 1000000
				fen = parseInt(fen)
				if (fen < 1000000){
					fen = '0' + fen
				}
				mui('.score_100w')[0].innerHTML = fen
			}
			
			
			function btn_color(){
				
				// 选择颜色
				up_color = Math.random()*3
				up_color = color[parseInt(up_color)]
				return up_color
				// alert(up_btn+up_color) 
				// [num+color]			
			}
			function btn_num(){
				// 选择按钮
				up_btn = Math.random()*4 + 1
				up_btn = parseInt(up_btn)
				up_btn = '.btn'+up_btn
				return up_btn
			}
			var color_time
			function game_main(){
				
				
				//解析谱面
				loading_pumian(a)//调用加载谱面函数
				var puzi
				var len = pumian.length
				
				
				
				for(var i = 0; i < len;i++){
					// alert(i)
					color_time = pumian[i]
					up_color = btn_color()//调用选择按钮颜色
					up_btn = btn_num()//调用选择按钮几
						// 应用谱面
					puzi = setTimeout(function(){
					mui(btn_num())[0].style = 'background-color: ' + up_color + ';'
					},color_time-200)
					
					
					on_click(up_btn)//判定点击
					
						
				}	
				// 游戏分数
				setTimeout(function(){
					// console.log('over')
					over(score,combo)
				},pumian[pumian.length - 1] + 3000)
			}
			var onclick_btn
			// 点击后颜色消失
			function on_click(up_btn){
				// btn1
				var btn1_hit = document.getElementById('btn1')
				
				onclick_btn = '.btn1'
				btn1_hit.onclick = function(){
					click_if(btn1_hit)
					mui('.btn1')[0].style = 'background-color: white;'
					
				}
				// btn2
				var btn2_hit = document.getElementById('btn2')
				onclick_btn = '.btn2'
				
				btn2_hit.onclick = function(){
					click_if(btn2_hit)
					mui('.btn2')[0].style = 'background-color: white;'
					
				}
				// btn3
				var btn3_hit = document.getElementById('btn3')
				onclick_btn = '.btn3'
				
				btn3_hit.onclick = function(){
					click_if(btn3_hit)
					mui('.btn3')[0].style = 'background-color: white;'
					
				}
				// btn4
				var btn4_hit = document.getElementById('btn4')
				onclick_btn = '.btn4'
				
				btn4_hit.onclick = function(){
					click_if(btn4_hit)
					mui('.btn4')[0].style = 'background-color: white;'
					
				}
			}
			// 判定点击
			function click_if(btn_name){
				var click_btn = getComputedStyle(btn_name)['background-color']
				// console.log(click_btn)
				if(click_btn != 'rgb(255, 255, 255)'){
					combo = combo + 1
					score = score + 1
					mui('.combo_num')[0].innerHTML = combo
				}
				else{
					combo = 0
					mui('.combo_num')[0].innerHTML = combo
				}
			}
		</script>
	</body>

</html>